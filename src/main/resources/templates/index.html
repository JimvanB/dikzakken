<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.com" lang="en">
<head>
    <title>Dikzakken</title>
    <meta charset="UTF-8"/>
    <link rel="stylesheet" type="text/css" href="styles/style.css"/>
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.css"/>
    <link rel="stylesheet" href="styles/styles.css"/>
    <script src="node_modules/jquery/dist/jquery.js"></script>
    <script type="text/javascript" src="js/gstatic.js"></script>
    <script type="text/javascript" src="js/modal.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {'packages': ['corechart']});
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            $.get("/chart", function (mydata) {
                var data = google.visualization.arrayToDataTable(mydata);
                var selectedGroupByDropdownBox = document.getElementById("groupBySelector");
                var selectedGroupBy = selectedGroupByDropdownBox.options[selectedGroupByDropdownBox.selectedIndex].value;


                var options = {
                    title: 'Voortgang',
                    vAxes: {
                        // Adds titles to each axis.
                        0: {title: 'Kg'}
                    },
                    hAxes: {
                        // Adds titles to each axis.
                        0: {title: selectedGroupBy}
                    },
                    chartArea: {left: 80, top: 50, right: 10},
                    legend: {position: 'bottom'}
                };

                var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

                chart.draw(data, options);
            });
        }

        function redrawChart() {
            var selectedUserDropdownBox = document.getElementById("chartSelector");
            var selectedUser = selectedUserDropdownBox.options[selectedUserDropdownBox.selectedIndex].value;

            var selectedGroupByDropdownBox = document.getElementById("groupBySelector");
            var selectedGroupBy = selectedGroupByDropdownBox.options[selectedGroupByDropdownBox.selectedIndex].value;


            if (selectedUser == 'all') {
                drawChart();
                return;
            }
            $.get("/chart/" + selectedUser + "/" + selectedGroupBy, function (mydata) {
                var data = google.visualization.arrayToDataTable(mydata);


                var options = {
                    title: 'Voortgang',
                    vAxes: {
                        // Adds titles to each axis.
                        0: {title: 'Kg'}
                    },
                    hAxes: {
                        // Adds titles to each axis.
                        0: {title: selectedGroupBy}
                    },
                    chartArea: {left: 80, top: 50, right: 10},
                    legend: {position: 'bottom'}
                };

                var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

                chart.draw(data, options);
            });
        }


    </script>
</head>
<body>
<section id="dikzakken">
    <div class="section-content">
        <div class="container">
            <div class="row py-2">
                <div class="col">
                    <h1>DIKZAKKEN</h1>
                </div>
                <div class="col">
                    <form th:action="@{/logout}" method="POST">
                        <input class="btn btn-danger float-right" type="submit" value="Logout"/>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>
<section>
    <div class="container">

        <div class="card">
            <h3 class="card-header">Meetingen</h3>
            <div class="card-block">


                <div class="row">
                    <div class="col-sm-12">
                        <div class="card-group">
                            <div class="card" th:each="deelnemer : ${deelnemers}">
                                <div class="card-header text-uppercase font-weight-bold text-center"
                                     th:text="${deelnemer.name + ' ' + deelnemer.getGewichtPercentageString()}">
                                </div>
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col">Datum</div>
                                        <div class="col">Kg</div>
                                        <div class="col">Omgvang</div>
                                    </div>
                                    <div class="row" th:each="meeting: ${deelnemer.metingen}">
                                        <div class="col"
                                             th:text="${#dates.format(meeting.getDate(), 'dd-MM-yy')}"></div>
                                        <div class="col" th:text="${meeting.gewicht}"></div>
                                        <div class="col" th:text="${meeting.omvang}"></div>
                                    </div>
                                    <div class="row">
                                        <div class="col"><b>Totaal:</b></div>
                                        <div class="col" th:if="${deelnemer.isDikker()}"
                                             style="color: red; font-weight: bold"
                                             th:text="${'+'+deelnemer.getGewichtVerschilAbsoluut()}"></div>
                                        <div class="col" th:if="${!deelnemer.isDikker()}"
                                             style="color: green; font-weight: bold"
                                             th:text="${deelnemer.getGewichtVerschilAbsoluut()}"></div>
                                        <div class="col" th:if="${deelnemer.isVetter()}"
                                             style="color: red;font-weight: bold"
                                             th:text="${'+'+deelnemer.getOmvangVerschilAbsoluut()}"></div>
                                        <div class="col" th:if="${!deelnemer.isVetter()}"
                                             style="color: green;font-weight: bold"
                                             th:text="${deelnemer.getOmvangVerschilAbsoluut()}"></div>
                                    </div>
                                </div>
                                <nav aria-label="..."  th:if="${#lists.size(deelnemer.metingen) >= 3}">
                                    <ul class="pagination pagination-sm justify-content-center">
                                        <li class="page-item">
                                            <a class="page-link" href="#" tabindex="-1">Previous</a>
                                        </li>
                                        <li class="page-item"><a class="page-link" href="#">1</a></li>
                                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                                        <li class="page-item">
                                            <a class="page-link" href="#">Next</a>
                                        </li>
                                    </ul>
                                </nav>
                                <div class="card-footer text-center">
                                    <a href="#" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" th:attr="data-whatever=${deelnemer.name}">Add</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<br/>
<section id="grafiek">
    <div class="container">
        <div class="card">
            <h3 class="card-header">Grafiek</h3>
            <div class="card-block">
                <div class="form-group row">
                    <label for="chartSelector" class="px-3 col-form-label">Deelnemer:</label>
                    <div class="col-2">
                        <select id="chartSelector" onchange="redrawChart();" class="custom-select">
                            <option value="all" selected="selected">Allemaal</option>
                            <option th:each="deelnemer : ${deelnemers}" th:if="${#lists.size(deelnemer.metingen) != 0}"
                                    th:value="${deelnemer.name}"
                                    th:text="${deelnemer.name}"></option>
                        </select>
                    </div>
                    <label for="chartSelector" class="px-3 col-form-label">Periode:</label>
                    <select id="groupBySelector" onchange="redrawChart();" class="custom-select">>
                        <option value="day" selected="selected">Day</option>
                        <option value="week">Week</option>
                        <option value="month">Month</option>
                        <option value="year">Year</option>
                    </select>
                </div>
                <div id="curve_chart" style="height: 400px;"></div>
            </div>
        </div>
    </div>
</section>

<script src="node_modules/bootstrap/dist/js/bootstrap.js"></script>


<!-- Add new meeting modal -->

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add meeting</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form method="post" th:object="${newmeeting}" th:action="@{/new/}">
                    <div class="row">
                        <label for="gewicht-input" class="px-3 col col-form-label">Gewicht:</label>
                        <div class="col">
                            <input type="text" class="form-control" th:field="*{gewicht}" id="gewicht-input"/>
                        </div>
                    </div>
                    <div class="row">
                        <label for="omvang-input" class="col col-form-label">Omvang:</label>
                        <div class="col">
                            <input type="text" class="form-control" th:field="*{omvang}" id="omvang-input"/>
                        </div>
                    </div>
                    <div class="row">
                        <label for="date-input" class="col col-form-label">Date</label>
                        <div class="col">
                            <input class="form-control" th:field="*{time}" type="date" id="date-input"/>
                        </div>
                    </div>
                    <div class="row">
                        <label class="col col-form-label">Deelnemer</label>
                        <div class="col">
                            <input type="text" class="form-control" th:field="*{name}" id="deelnemer-name" readonly="readonly"/>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col text-center">
                            <button type="submit" class="btn btn-primary">Save</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


</body>
</html>